/*!
 * w-ftp v1.0.2
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("path"),require("fs"),require("net"),require("events"),require("util"),require("stream"),require("stream-combiner"),require("ftp-response-parser"),require("parse-listing"),require("once"),require("unorm"),require("debug")):"function"==typeof define&&define.amd?define(["path","fs","net","events","util","stream","stream-combiner","ftp-response-parser","parse-listing","once","unorm","debug"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-ftp"]=e(t.path,t.fs,t.net,t.events,t.util,t.stream,t["stream-combiner"],t["ftp-response-parser"],t["parse-listing"],t.once,t.unorm,t.debug)}(this,(function(t,e,r,n,o,i,a,u,c,s,f,l){"use strict";function p(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var h=p(t),v=p(e),d=p(r),y=p(n),b=p(o),g=p(i),m=p(a),_=p(u),j=p(c),w=p(s),k=p(f),S=p(l),O=Array.isArray,x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function P(t){var e={exports:{}};return t(e,e.exports),e.exports}var z="object"==typeof x&&x&&x.Object===Object&&x,A="object"==typeof self&&self&&self.Object===Object&&self,F=z||A||Function("return this")(),E=F.Symbol,T=Object.prototype,R=T.hasOwnProperty,C=T.toString,L=E?E.toStringTag:void 0;var I=function(t){var e=R.call(t,L),r=t[L];try{t[L]=void 0;var n=!0}catch(t){}var o=C.call(t);return n&&(e?t[L]=r:delete t[L]),o},M=Object.prototype.toString;var q=function(t){return M.call(t)},N=E?E.toStringTag:void 0;var $=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":N&&N in Object(t)?I(t):q(t)};var U=function(t){return null!=t&&"object"==typeof t};var B=function(t){return"symbol"==typeof t||U(t)&&"[object Symbol]"==$(t)},D=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Q=/^\w*$/;var V=function(t,e){if(O(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!B(t))||(Q.test(t)||!D.test(t)||null!=e&&t in Object(e))};var W=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var G,H=function(t){if(!W(t))return!1;var e=$(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},J=F["__core-js_shared__"],K=(G=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||""))?"Symbol(src)_1."+G:"";var X=function(t){return!!K&&K in t},Y=Function.prototype.toString;var Z=function(t){if(null!=t){try{return Y.call(t)}catch(t){}try{return t+""}catch(t){}}return""},tt=/^\[object .+?Constructor\]$/,et=Function.prototype,rt=Object.prototype,nt=et.toString,ot=rt.hasOwnProperty,it=RegExp("^"+nt.call(ot).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var at=function(t){return!(!W(t)||X(t))&&(H(t)?it:tt).test(Z(t))};var ut=function(t,e){return null==t?void 0:t[e]};var ct=function(t,e){var r=ut(t,e);return at(r)?r:void 0},st=ct(Object,"create");var ft=function(){this.__data__=st?st(null):{},this.size=0};var lt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},pt=Object.prototype.hasOwnProperty;var ht=function(t){var e=this.__data__;if(st){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return pt.call(e,t)?e[t]:void 0},vt=Object.prototype.hasOwnProperty;var dt=function(t){var e=this.__data__;return st?void 0!==e[t]:vt.call(e,t)};var yt=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=st&&void 0===e?"__lodash_hash_undefined__":e,this};function bt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}bt.prototype.clear=ft,bt.prototype.delete=lt,bt.prototype.get=ht,bt.prototype.has=dt,bt.prototype.set=yt;var gt=bt;var mt=function(){this.__data__=[],this.size=0};var _t=function(t,e){return t===e||t!=t&&e!=e};var jt=function(t,e){for(var r=t.length;r--;)if(_t(t[r][0],e))return r;return-1},wt=Array.prototype.splice;var kt=function(t){var e=this.__data__,r=jt(e,t);return!(r<0)&&(r==e.length-1?e.pop():wt.call(e,r,1),--this.size,!0)};var St=function(t){var e=this.__data__,r=jt(e,t);return r<0?void 0:e[r][1]};var Ot=function(t){return jt(this.__data__,t)>-1};var xt=function(t,e){var r=this.__data__,n=jt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function Pt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Pt.prototype.clear=mt,Pt.prototype.delete=kt,Pt.prototype.get=St,Pt.prototype.has=Ot,Pt.prototype.set=xt;var zt=Pt,At=ct(F,"Map");var Ft=function(){this.size=0,this.__data__={hash:new gt,map:new(At||zt),string:new gt}};var Et=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Tt=function(t,e){var r=t.__data__;return Et(e)?r["string"==typeof e?"string":"hash"]:r.map};var Rt=function(t){var e=Tt(this,t).delete(t);return this.size-=e?1:0,e};var Ct=function(t){return Tt(this,t).get(t)};var Lt=function(t){return Tt(this,t).has(t)};var It=function(t,e){var r=Tt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function Mt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Mt.prototype.clear=Ft,Mt.prototype.delete=Rt,Mt.prototype.get=Ct,Mt.prototype.has=Lt,Mt.prototype.set=It;var qt=Mt;function Nt(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=t.apply(this,n);return r.cache=i.set(o,a)||i,a};return r.cache=new(Nt.Cache||qt),r}Nt.Cache=qt;var $t=Nt;var Ut=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Bt=/\\(\\)?/g,Dt=function(t){var e=$t(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Ut,(function(t,r,n,o){e.push(n?o.replace(Bt,"$1"):r||t)})),e}));var Qt=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},Vt=E?E.prototype:void 0,Wt=Vt?Vt.toString:void 0;var Gt=function t(e){if("string"==typeof e)return e;if(O(e))return Qt(e,t)+"";if(B(e))return Wt?Wt.call(e):"";var r=e+"";return"0"==r&&1/e==-Infinity?"-0":r};var Ht=function(t){return null==t?"":Gt(t)};var Jt=function(t,e){return O(t)?t:V(t,e)?[t]:Dt(Ht(t))};var Kt=function(t){if("string"==typeof t||B(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e};var Xt=function(t,e){for(var r=0,n=(e=Jt(e,t)).length;null!=t&&r<n;)t=t[Kt(e[r++])];return r&&r==n?t:void 0};var Yt=function(t,e,r){var n=null==t?void 0:Xt(t,e);return void 0===n?r:n},Zt=Object.prototype;var te=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Zt)};var ee=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),re=Object.prototype.hasOwnProperty;var ne=function(t){if(!te(t))return ee(t);var e=[];for(var r in Object(t))re.call(t,r)&&"constructor"!=r&&e.push(r);return e},oe=ct(F,"DataView"),ie=ct(F,"Promise"),ae=ct(F,"Set"),ue=ct(F,"WeakMap"),ce="[object Map]",se="[object Promise]",fe="[object Set]",le="[object WeakMap]",pe="[object DataView]",he=Z(oe),ve=Z(At),de=Z(ie),ye=Z(ae),be=Z(ue),ge=$;(oe&&ge(new oe(new ArrayBuffer(1)))!=pe||At&&ge(new At)!=ce||ie&&ge(ie.resolve())!=se||ae&&ge(new ae)!=fe||ue&&ge(new ue)!=le)&&(ge=function(t){var e=$(t),r="[object Object]"==e?t.constructor:void 0,n=r?Z(r):"";if(n)switch(n){case he:return pe;case ve:return ce;case de:return se;case ye:return fe;case be:return le}return e});var me=ge;var _e=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var je=function(t){return null!=t&&_e(t.length)&&!H(t)};var we=function(t){return"string"==typeof t||!O(t)&&U(t)&&"[object String]"==$(t)};var ke=function(t){return function(e){return null==e?void 0:e[t]}},Se=ke("length"),Oe=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var xe=function(t){return Oe.test(t)},Pe="[\\ud800-\\udfff]",ze="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ae="\\ud83c[\\udffb-\\udfff]",Fe="[^\\ud800-\\udfff]",Ee="(?:\\ud83c[\\udde6-\\uddff]){2}",Te="[\\ud800-\\udbff][\\udc00-\\udfff]",Re="(?:"+ze+"|"+Ae+")"+"?",Ce="[\\ufe0e\\ufe0f]?",Le=Ce+Re+("(?:\\u200d(?:"+[Fe,Ee,Te].join("|")+")"+Ce+Re+")*"),Ie="(?:"+[Fe+ze+"?",ze,Ee,Te,Pe].join("|")+")",Me=RegExp(Ae+"(?="+Ae+")|"+Ie+Le,"g");var qe=function(t){for(var e=Me.lastIndex=0;Me.test(t);)++e;return e};var Ne=function(t){return xe(t)?qe(t):Se(t)};var $e=function(t){if(null==t)return 0;if(je(t))return we(t)?Ne(t):t.length;var e=me(t);return"[object Map]"==e||"[object Set]"==e?t.size:ne(t).length};var Ue=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i};var Be=function(t){return function(e,r,n){for(var o=-1,i=Object(e),a=n(e),u=a.length;u--;){var c=a[t?u:++o];if(!1===r(i[c],c,i))break}return e}}();var De=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var Qe=function(t){return U(t)&&"[object Arguments]"==$(t)},Ve=Object.prototype,We=Ve.hasOwnProperty,Ge=Ve.propertyIsEnumerable,He=Qe(function(){return arguments}())?Qe:function(t){return U(t)&&We.call(t,"callee")&&!Ge.call(t,"callee")},Je=He;var Ke=function(){return!1},Xe=P((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?F.Buffer:void 0,i=(o?o.isBuffer:void 0)||Ke;t.exports=i})),Ye=/^(?:0|[1-9]\d*)$/;var Ze=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Ye.test(t))&&t>-1&&t%1==0&&t<e},tr={};tr["[object Float32Array]"]=tr["[object Float64Array]"]=tr["[object Int8Array]"]=tr["[object Int16Array]"]=tr["[object Int32Array]"]=tr["[object Uint8Array]"]=tr["[object Uint8ClampedArray]"]=tr["[object Uint16Array]"]=tr["[object Uint32Array]"]=!0,tr["[object Arguments]"]=tr["[object Array]"]=tr["[object ArrayBuffer]"]=tr["[object Boolean]"]=tr["[object DataView]"]=tr["[object Date]"]=tr["[object Error]"]=tr["[object Function]"]=tr["[object Map]"]=tr["[object Number]"]=tr["[object Object]"]=tr["[object RegExp]"]=tr["[object Set]"]=tr["[object String]"]=tr["[object WeakMap]"]=!1;var er=function(t){return U(t)&&_e(t.length)&&!!tr[$(t)]};var rr=function(t){return function(e){return t(e)}},nr=P((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&z.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),or=nr&&nr.isTypedArray,ir=or?rr(or):er,ar=Object.prototype.hasOwnProperty;var ur=function(t,e){var r=O(t),n=!r&&Je(t),o=!r&&!n&&Xe(t),i=!r&&!n&&!o&&ir(t),a=r||n||o||i,u=a?De(t.length,String):[],c=u.length;for(var s in t)!e&&!ar.call(t,s)||a&&("length"==s||o&&("offset"==s||"parent"==s)||i&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Ze(s,c))||u.push(s);return u};var cr=function(t){return je(t)?ur(t):ne(t)};var sr=function(t,e){return function(r,n){if(null==r)return r;if(!je(r))return t(r,n);for(var o=r.length,i=e?o:-1,a=Object(r);(e?i--:++i<o)&&!1!==n(a[i],i,a););return r}}((function(t,e){return t&&Be(t,e,cr)}));var fr=function(t,e){var r=[];return sr(t,(function(t,n,o){e(t,n,o)&&r.push(t)})),r};var lr=function(){this.__data__=new zt,this.size=0};var pr=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var hr=function(t){return this.__data__.get(t)};var vr=function(t){return this.__data__.has(t)};var dr=function(t,e){var r=this.__data__;if(r instanceof zt){var n=r.__data__;if(!At||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new qt(n)}return r.set(t,e),this.size=r.size,this};function yr(t){var e=this.__data__=new zt(t);this.size=e.size}yr.prototype.clear=lr,yr.prototype.delete=pr,yr.prototype.get=hr,yr.prototype.has=vr,yr.prototype.set=dr;var br=yr;var gr=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var mr=function(t){return this.__data__.has(t)};function _r(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new qt;++e<r;)this.add(t[e])}_r.prototype.add=_r.prototype.push=gr,_r.prototype.has=mr;var jr=_r;var wr=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var kr=function(t,e){return t.has(e)};var Sr=function(t,e,r,n,o,i){var a=1&r,u=t.length,c=e.length;if(u!=c&&!(a&&c>u))return!1;var s=i.get(t),f=i.get(e);if(s&&f)return s==e&&f==t;var l=-1,p=!0,h=2&r?new jr:void 0;for(i.set(t,e),i.set(e,t);++l<u;){var v=t[l],d=e[l];if(n)var y=a?n(d,v,l,e,t,i):n(v,d,l,t,e,i);if(void 0!==y){if(y)continue;p=!1;break}if(h){if(!wr(e,(function(t,e){if(!kr(h,e)&&(v===t||o(v,t,r,n,i)))return h.push(e)}))){p=!1;break}}else if(v!==d&&!o(v,d,r,n,i)){p=!1;break}}return i.delete(t),i.delete(e),p},Or=F.Uint8Array;var xr=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var Pr=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},zr=E?E.prototype:void 0,Ar=zr?zr.valueOf:void 0;var Fr=function(t,e,r,n,o,i,a){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Or(t),new Or(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return _t(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=xr;case"[object Set]":var c=1&n;if(u||(u=Pr),t.size!=e.size&&!c)return!1;var s=a.get(t);if(s)return s==e;n|=2,a.set(t,e);var f=Sr(u(t),u(e),n,o,i,a);return a.delete(t),f;case"[object Symbol]":if(Ar)return Ar.call(t)==Ar.call(e)}return!1};var Er=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t};var Tr=function(t,e,r){var n=e(t);return O(t)?n:Er(n,r(t))};var Rr=function(){return[]},Cr=Object.prototype.propertyIsEnumerable,Lr=Object.getOwnPropertySymbols,Ir=Lr?function(t){return null==t?[]:(t=Object(t),Ue(Lr(t),(function(e){return Cr.call(t,e)})))}:Rr;var Mr=function(t){return Tr(t,cr,Ir)},qr=Object.prototype.hasOwnProperty;var Nr=function(t,e,r,n,o,i){var a=1&r,u=Mr(t),c=u.length;if(c!=Mr(e).length&&!a)return!1;for(var s=c;s--;){var f=u[s];if(!(a?f in e:qr.call(e,f)))return!1}var l=i.get(t),p=i.get(e);if(l&&p)return l==e&&p==t;var h=!0;i.set(t,e),i.set(e,t);for(var v=a;++s<c;){var d=t[f=u[s]],y=e[f];if(n)var b=a?n(y,d,f,e,t,i):n(d,y,f,t,e,i);if(!(void 0===b?d===y||o(d,y,r,n,i):b)){h=!1;break}v||(v="constructor"==f)}if(h&&!v){var g=t.constructor,m=e.constructor;g==m||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof m&&m instanceof m||(h=!1)}return i.delete(t),i.delete(e),h},$r="[object Arguments]",Ur="[object Array]",Br="[object Object]",Dr=Object.prototype.hasOwnProperty;var Qr=function(t,e,r,n,o,i){var a=O(t),u=O(e),c=a?Ur:me(t),s=u?Ur:me(e),f=(c=c==$r?Br:c)==Br,l=(s=s==$r?Br:s)==Br,p=c==s;if(p&&Xe(t)){if(!Xe(e))return!1;a=!0,f=!1}if(p&&!f)return i||(i=new br),a||ir(t)?Sr(t,e,r,n,o,i):Fr(t,e,c,r,n,o,i);if(!(1&r)){var h=f&&Dr.call(t,"__wrapped__"),v=l&&Dr.call(e,"__wrapped__");if(h||v){var d=h?t.value():t,y=v?e.value():e;return i||(i=new br),o(d,y,r,n,i)}}return!!p&&(i||(i=new br),Nr(t,e,r,n,o,i))};var Vr=function t(e,r,n,o,i){return e===r||(null==e||null==r||!U(e)&&!U(r)?e!=e&&r!=r:Qr(e,r,n,o,t,i))};var Wr=function(t,e,r,n){var o=r.length,i=o,a=!n;if(null==t)return!i;for(t=Object(t);o--;){var u=r[o];if(a&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++o<i;){var c=(u=r[o])[0],s=t[c],f=u[1];if(a&&u[2]){if(void 0===s&&!(c in t))return!1}else{var l=new br;if(n)var p=n(s,f,c,t,e,l);if(!(void 0===p?Vr(f,s,3,n,l):p))return!1}}return!0};var Gr=function(t){return t==t&&!W(t)};var Hr=function(t){for(var e=cr(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,Gr(o)]}return e};var Jr=function(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}};var Kr=function(t){var e=Hr(t);return 1==e.length&&e[0][2]?Jr(e[0][0],e[0][1]):function(r){return r===t||Wr(r,t,e)}};var Xr=function(t,e){return null!=t&&e in Object(t)};var Yr=function(t,e,r){for(var n=-1,o=(e=Jt(e,t)).length,i=!1;++n<o;){var a=Kt(e[n]);if(!(i=null!=t&&r(t,a)))break;t=t[a]}return i||++n!=o?i:!!(o=null==t?0:t.length)&&_e(o)&&Ze(a,o)&&(O(t)||Je(t))};var Zr=function(t,e){return null!=t&&Yr(t,e,Xr)};var tn=function(t,e){return V(t)&&Gr(e)?Jr(Kt(t),e):function(r){var n=Yt(r,t);return void 0===n&&n===e?Zr(r,t):Vr(e,n,3)}};var en=function(t){return t};var rn=function(t){return function(e){return Xt(e,t)}};var nn=function(t){return V(t)?ke(Kt(t)):rn(t)};var on=function(t){return"function"==typeof t?t:null==t?en:"object"==typeof t?O(t)?tn(t[0],t[1]):Kr(t):nn(t)};var an=function(t,e){return(O(t)?Ue:fr)(t,on(e))};var un=function(t){return function(e,r,n){var o=Object(e);if(!je(e)){var i=on(r);e=cr(e),r=function(t){return i(o[t],t,o)}}var a=t(e,r,n);return a>-1?o[i?e[a]:a]:void 0}};var cn=function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1},sn=/\s/;var fn=function(t){for(var e=t.length;e--&&sn.test(t.charAt(e)););return e},ln=/^\s+/;var pn=function(t){return t?t.slice(0,fn(t)+1).replace(ln,""):t},hn=/^[-+]0x[0-9a-f]+$/i,vn=/^0b[01]+$/i,dn=/^0o[0-7]+$/i,yn=parseInt;var bn=function(t){if("number"==typeof t)return t;if(B(t))return NaN;if(W(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=W(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=pn(t);var r=vn.test(t);return r||dn.test(t)?yn(t.slice(2),r?2:8):hn.test(t)?NaN:+t},gn=1/0;var mn=function(t){return t?(t=bn(t))===gn||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var _n=function(t){var e=mn(t),r=e%1;return e==e?r?e-r:e:0},jn=Math.max;var wn=un((function(t,e,r){var n=null==t?0:t.length;if(!n)return-1;var o=null==r?0:_n(r);return o<0&&(o=jn(n+o,0)),cn(t,on(e),o)}));var kn=function(t,e){var r=-1,n=je(t)?Array(t.length):[];return sr(t,(function(t,o,i){n[++r]=e(t,o,i)})),n};var Sn=function(t,e){return(O(t)?Qt:kn)(t,on(e))};function On(){let t,e,r=new Promise((function(){t=arguments[0],e=arguments[1]}));return r.resolve=t,r.reject=e,r}var xn=F.isFinite,Pn=Math.min;var zn=function(t){var e=Math[t];return function(t,r){if(t=bn(t),(r=null==r?0:Pn(_n(r),292))&&xn(t)){var n=(Ht(t)+"e").split("e"),o=e(n[0]+"e"+(+n[1]+r));return+((n=(Ht(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round");function An(t){return!(!function(t){return"[object String]"===Object.prototype.toString.call(t)}(t)||""===t)}function Fn(t){let e=!1;return An(t)?e=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(e=!0),e}function En(t){if(!Fn(t))return 0;return mn(t)}function Tn(t){if(!Fn(t))return 0;t=En(t);let e=zn(t);return"0"===String(e)?0:e}function Rn(t){if(!An(t)&&!Fn(t)&&!B(t))return"";let e="";try{e=String(t)}catch(t){}try{e=t.toString()}catch(t){}return e}var Cn=function(t){return"number"==typeof t&&t==_n(t)};function Ln(t){return!!Fn(t)&&(t=En(t),Cn(t))}function In(t){if(!Ln(t))return!1;return Tn(t)>0}function Mn(t){return"[object Object]"===Object.prototype.toString.call(t)}function qn(t){if(Mn(t)){for(let e in t)return!0;return!1}return!1}function Nn(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function $n(t){if(!Ln(t))return!1;return Tn(t)>=0}function Un(t,e){return An(t)&&$n(e)?0===(e=Tn(e))?"":t.substring(0,e):""}var Bn=function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var i=Array(o);++n<o;)i[n]=t[n+e];return i};var Dn=function(t,e,r){var n=null==t?0:t.length;return n?(e=r||void 0===e?1:_n(e),Bn(t,e<0?0:e,n)):[]};var Qn=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t};var Vn=function(t){return"function"==typeof t?t:en};var Wn=function(t,e){return(O(t)?Qn:sr)(t,Vn(e))};function Gn(t,e){let r=On();if(n=t,"[object Array]"!==Object.prototype.toString.call(n)&&!Mn(t))return r.reject("rs is not array or object"),r;var n;let o=!1;if(Mn(t)){o=!0;let e=[];Wn(t,((t,r)=>{e.push({k:r,v:t})})),t=e}Nn(e)||(e=function(t){return t});let i=-1,a=[];return t.reduce((function(t,r){return t.then((function(t){a.push(t),i+=1;let n=i,u=r;return o&&(n=r.k,u=r.v),Nn(e)?e(u,n):u}))}),Promise.resolve()).then((function(t){a.push(t),a=Dn(a),r.resolve(a)})).catch((function(t){r.reject(t)})),r}function Hn(t,e){if(!An(t))return"";if(!$n(e))return"";if(0===(e=Tn(e)))return"";let r=t.length-e;return r<0&&(r=0),t.substr(r,e)}function Jn(t,e){return An(t)&&$n(e)?0===(e=Tn(e))?t:Un(t,t.length-e):""}function Kn(t){if(!An(t))return"";let e=function(t){if(!An(t))return{path:"",isRoot:!1};for(;t.indexOf("\\\\")>=0;)t=t.replace("\\\\","\\");for(;t.indexOf("//")>=0;)t=t.replace("//","/");if(":"===Hn(t,1))return{path:"".concat(t,"\\"),isRoot:!0};if("\\"===Hn(t,1)){let e=Jn(t,1);return":"===Hn(e,1)?{path:t,isRoot:!0}:{path:e,isRoot:!1}}if("/"===Hn(t,1)){let e=Jn(t,1);return 0===$e(e)?{path:t,isRoot:!0}:{path:e,isRoot:!1}}return{path:t,isRoot:!1}}(t);if(e.isRoot)return e.path;let r=e.path;try{r=r.split("\\").pop().split("/").pop()}catch(t){}return r}function Xn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=1;function n(t){let o=[],i=v.default.readdirSync(t);return Wn(i,(function(i){let a=h.default.resolve(t,i),u=null;try{u=v.default.statSync(a)}catch(t){}u&&u.isDirectory()?(o.push({isFolder:!0,level:r,path:a,name:h.default.basename(a)}),r+=1,(r<=e||null===e)&&(o=o.concat(n(a))),r-=1):o.push({isFolder:!1,level:r,path:a,name:h.default.basename(a)})})),o}return n(t)}function Yn(t){return!!v.default.existsSync(t)&&(!v.default.lstatSync(t).isFile()&&!v.default.lstatSync(t).isSymbolicLink())}function Zn(t){return!!v.default.existsSync(t)&&(!v.default.lstatSync(t).isDirectory()&&!v.default.lstatSync(t).isSymbolicLink())}function to(t){if(Yn(t))return{success:"input folder is already exists: "+t};if(v.default.existsSync(t))return{error:"input path already exists: "+t};try{v.default.mkdirSync(t,{recursive:!0})}catch(t){return{error:t}}return{success:"done: "+t}}const eo=d.default.createConnection,ro=y.default.EventEmitter,no=b.default.inherits,oo=k.default.nfc,io=S.default("jsftp:general"),ao=S.default("jsftp:command"),uo=S.default("jsftp:response"),co=6e5,so=function(){},fo={marks:[125,150],ignore:226},lo=/([-\d]+,[-\d]+,[-\d]+,[-\d]+),([-\d]+),([-\d]+)/,po=/\r\n|\n/;function ho(t){let e=so,r=t+" ";for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];"function"==typeof o[o.length-1]&&(e=o.pop()),r+=o.join(" "),this.execute(r.trim(),e)}function vo(t){this.host=t.host||"localhost",this.port=t.port||21,this.user=t.user||"anonymous",this.pass=t.pass||"@anonymous",this.createSocket=t.createSocket,this.useList=t.useList||!1,this.commandQueue=[],ro.call(this),this.on("data",uo),this.on("error",uo),this._createSocket(this.port,this.host)}no(vo,ro),vo.prototype.raw=function(){ho.apply(this,arguments)},vo.prototype.reemit=function(t){return e=>{this.emit(t,e),io("event:".concat(t),e||{})}},vo.prototype._createSocket=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:so;this.socket&&this.socket.destroy&&this.socket.destroy(),this.resParser&&this.resParser.end(),this.resParser=new _.default,this.authenticated=!1,this.socket=this.createSocket?this.createSocket({port:t,host:e},r):eo(t,e,r),this.socket.on("connect",this.reemit("connect")),this.socket.on("timeout",this.reemit("timeout")),this.pipeline=m.default(this.socket,this.resParser),this.pipeline.on("data",(t=>{this.emit("data",t),uo(t.text),this.parseResponse(t)})),this.pipeline.on("error",this.reemit("error"))},vo.prototype.parseResponse=function(t){if(0===this.commandQueue.length)return;if([220].indexOf(t.code)>-1)return;const e=this.commandQueue[0].callback;if(t.isMark){if(!e.expectsMark||-1===e.expectsMark.marks.indexOf(t.code))return;e.expectsMark.ignore&&(this.ignoreCmdCode=e.expectsMark.ignore)}this.ignoreCmdCode!==t.code?this.parse(t,this.commandQueue.shift()):this.ignoreCmdCode=null},vo.prototype.send=function(t){t&&(ao(t),this.pipeline.write(t+"\r\n"),ao(t))},vo.prototype.nextCmd=function(){const t=this.commandQueue[0];!this.inProgress&&t&&(this.send(t.action),this.inProgress=!0)},vo.prototype.execute=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:so;if(this.socket&&this.socket.writable)return this.runCommand({action:t,callback:e});this.authenticated=!1,this._createSocket(this.port,this.host,(()=>{this.runCommand({action:t,callback:e})}))},vo.prototype.runCommand=function(t){if(this.authenticated||/^(feat|syst|user|pass)/.test(t.action))return this.commandQueue.push(t),void this.nextCmd();this.getFeatures((()=>{this.auth(this.user,this.pass,(()=>{this.commandQueue.push(t),this.nextCmd()}))}))},vo.prototype.parse=function(t,e){let r=null;t.isError&&(r=new Error(t.text||"Unknown FTP error."),r.code=t.code),this.inProgress=!1,e.callback(r,t),this.nextCmd()},vo.prototype.getPasvPort=function(t){const e=lo.exec(t);if(!e)return null;let r=e[1].replace(/,/g,".");return"127.0.0.1"===r&&(r=this.host),{host:r,port:256*(255&parseInt(e[2],10))+(255&parseInt(e[3],10))}},vo.prototype.hasFeat=function(t){return!!t&&this.features.indexOf(t.toLowerCase())>-1},vo.prototype._parseFeats=function(t){return t.split(po).slice(1,-1).map((t=>t.trim().toLowerCase())).filter((t=>!!t))},vo.prototype.getFeatures=function(t){if(this.features)return t(null,this.features);this.raw("feat",((e,r)=>{this.features=e?[]:this._parseFeats(r.text),this.raw("syst",((e,r)=>{e||215!==r.code||(this.system=r.text.toLowerCase()),t(null,this.features)}))}))},vo.prototype.auth=function(t,e,r){if(!0===this.authenticating)return r(new Error("This client is already authenticating"));"string"!=typeof t&&(t=this.user),"string"!=typeof e&&(e=this.pass),this.authenticating=!0,this.raw("user",t,((n,o)=>{if(n||-1===[230,331,332].indexOf(o.code))return this.authenticating=!1,void r(n);this.raw("pass",e,((n,o)=>{this.authenticating=!1,n?r(n):[230,202].indexOf(o.code)>-1?(this.authenticated=!0,this.user=t,this.pass=e,this.raw("type","I",(()=>{r(void 0,o)}))):332===o.code&&this.raw("acct","")}))}))},vo.prototype.setType=function(t,e){if(t=t.toUpperCase(),this.type===t)return e();this.raw("type",t,((r,n)=>{r||(this.type=t),e(r,n)}))},vo.prototype.list=function(t,e){1===arguments.length&&(e=arguments[0],t="");let r="";e=w.default(e),this.getPasvSocket(((n,o)=>{if(n)return e(n);function i(t,r){if(t)return e(t);fo.marks.some((t=>t===r.code))||e(new Error("Expected marks ".concat(fo.toString()," instead of: ").concat(r.text)))}o.setEncoding("utf8"),o.on("data",(t=>{r+=t})),this.pasvTimeout(o,e),o.once("close",(n=>n?e(n):r?void e(null,r):e({code:451,text:"Could not retrieve a file listing for ".concat(t,"."),isMark:!1,isError:!0}))),o.once("error",e),i.expectsMark=fo,this.execute("list ".concat(t||""),i)}))},vo.prototype.emitProgress=function(t){this.emit("progress",{filename:t.filename,action:t.action,total:t.totalSize||0,transferred:t.socket["get"===t.action?"bytesRead":"bytesWritten"]})},vo.prototype.get=function(t,e){let r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:so;const o=typeof e;"function"===o?r=e:"string"===o&&(n=w.default(n),r=(r,o)=>{if(r)return n(r);const i=v.default.createWriteStream(e);i.on("error",n),o.on("readable",(()=>{this.emitProgress({filename:t,action:"get",socket:o})})),o.on("error",n),o.on("end",n),o.on("close",n),o.pipe(i)}),this.getGetSocket(t,w.default(r))},vo.prototype.getGetSocket=function(t,e){e=w.default(e),this.getPasvSocket(((r,n)=>{if(r)return o(r);function o(t,r){return t?(n&&n.destroy(),e(t)):n?125===r.code||150===r.code?e(null,n):(n.destroy(),e(new Error("Unexpected command "+r.text))):e(new Error("Error when retrieving PASV socket"))}n.on("error",(t=>{"ECONNREFUSED"===t.code&&(t.msg="Probably trying a PASV operation while one is in progress"),o(t)})),this.pasvTimeout(n,o),n.pause(),o.expectsMark=fo,this.execute("retr "+t,o)}))},vo.prototype.put=function(t,e,r){const n=(t,e,n)=>{t.on("readable",(()=>{this.emitProgress({filename:e,action:"put",socket:t,totalSize:n})})),this.getPutSocket(t,e,r)};t instanceof Buffer?this.getPutSocket(t,e,((e,n)=>{if(e)return r(new Error(e));let o,i=0,a=1048576,u=!1;o=t.slice(i,i+a),i+=a,r(null,o),n.write(t.slice(0,a)),o.length===t.length&&(n.end(),r(null,[])),n.on("drain",(()=>{console.log("drain"),t.length>i+a?(o=t.slice(i,i+a),i+=a):(o=t.slice(i),u=!0),r(null,o),n.write(o),u&&(n.end(),r(null,[]))}))})):"string"==typeof t?v.default.stat(t,((o,i)=>{if(o&&"ENOENT"===o.code)return r(new Error("Local file doesn't exist."));if(i.isDirectory())return r(new Error("Local path cannot be a directory"));const a=o?0:i.size;n(v.default.createReadStream(t),e,a)})):t instanceof g.default.Readable?n(t,e,0):r(new Error("Expected `from` parameter to be a Buffer, Stream, or a String"))},vo.prototype.getPutSocket=function(t,e,r){r=w.default(r||so),this.getPasvSocket(((n,o)=>{if(n)return o&&o.destroy(),r(n);o.on("close",r),o.on("error",r);const i=w.default(((e,n)=>e?(o&&o.destroy(),r(e)):125!==n.code&&150!==n.code?(o&&o.destroy(),r(new Error("Unexpected command "+n.text))):(this.pasvTimeout(o,r),void(t instanceof Buffer?r(null,o):t instanceof g.default.Readable&&(r(null,o),t.pipe(o))))));i.expectsMark=fo,this.execute("stor ".concat(e),i)}))},vo.prototype.pasvTimeout=function(t,e){t.once("timeout",(()=>{io("PASV socket timeout"),this.emit("timeout"),t.end(),e(new Error("Passive socket timeout"))}))},vo.prototype.getPasvSocket=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:so;t=w.default(t),this.execute("pasv",((e,r)=>{if(e)return t(e);const n=this.getPasvPort(r.text);if(!n)return t(new Error("Bad passive host/port combination"));const o=this._pasvSocket=this.createSocket?this.createSocket(n):eo(n);o.setTimeout(this.timeout||co),o.once("close",(()=>{this._pasvSocket=void 0})),t(null,o)}))},vo.prototype.ls=function(t,e){function r(t,r){if(t)return e(t);j.default.parseFtpEntries(r.text||r,((t,r)=>{if(t)return e(t);r.forEach((t=>{t.name=oo(t.name)})),e(null,r)}))}this.useList?this.list(t,r):this.raw("stat",t,((e,n)=>{const o=e&&(502===e.code||500===e.code),i=this.system&&this.system.indexOf("hummingbird")>-1;o||i?(this.useList=!0,this.list(t,r)):r(e,n)}))},vo.prototype.rename=function(t,e,r){this.raw("rnfr",t,(t=>{if(t)return r(t);this.raw("rnto",e,r)}))},vo.prototype.keepAlive=function(t){this._keepAliveInterval&&clearInterval(this._keepAliveInterval),this._keepAliveInterval=setInterval(this.raw.bind(this,"noop"),t||3e4)},vo.prototype.destroy=function(){this._keepAliveInterval&&clearInterval(this._keepAliveInterval),this.socket&&this.socket.writable&&this.socket.end(),this._pasvSocket&&this._pasvSocket.writable&&this._pasvSocket.end(),this.resParser.end(),this.socket=void 0,this._pasvSocket=void 0,this.features=null,this.authenticated=!1};var yo=vo;async function bo(){return null}async function go(){return null}async function mo(){return null}async function _o(t){return null}async function jo(t){return null}async function wo(t,e){return null}async function ko(t,e,r){return null}async function So(t,e,r){return null}async function Oo(t,e,r){return null}return function(){return this._={doc_ftpConn:bo,doc_ftpLs:go,doc_ftpQuit:mo,doc_ftpStateFile:_o,doc_ftpCheckFile:jo,doc_ftpDownload:wo,doc_ftpUpload:ko,doc_ftpSyncToLocal:So,doc_ftpSyncToRemote:Oo},new function(){let t=null;async function e(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".",r=On();return null===t?(r.reject("FTP has not been initialized. please use 'conn' to construct FTP"),r):(t.ls(e,((t,e)=>{t?r.reject(t):r.resolve(e)})),r)}async function r(t){let r=null;return await e(t).then((t=>{r=t})).catch((()=>{r=null})),r=Yt(r,0,null),r}async function n(e,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=On();if(null===t)return i.reject("FTP has not been initialized. please use 'conn' to construct FTP"),i;if(!An(e))return i.reject("fpRemote[".concat(e,"] is not a effective string")),i;if(!An(n))return i.reject("fpLocal[".concat(n,"] is not a effective string")),i;let a=h.default.basename(h.default.dirname(n));Yn(a)||to(a);let u=await r(e),c=Yt(u,"size");return Fn(c)?(c=Tn(c),t.get(e,((t,r)=>{t&&i.reject(t),Zn(n)&&v.default.unlinkSync(n);let a=v.default.createWriteStream(n),u=0;r.on("data",(t=>{if(Nn(o)){let r=$e(t);u+=r,o({progress:u/c*100,name:Kn(n),fpRemote:e,fpLocal:n})}a.write(t)})),r.on("close",(t=>{t?i.reject(t):i.resolve("ok")})),r.resume()})),i):(i.reject("can not get the size of file[".concat(e,"]")),i)}async function o(e,r,n){let o=On();if(null===t)return o.reject("FTP has not been initialized. please use 'conn' to construct FTP"),o;if(!An(r))return o.reject("fpRemote[".concat(r,"] is not a effective string")),o;if(!An(e))return o.reject("fpLocal[".concat(e,"] is not a effective string")),o;if(!Zn(e))return o.reject("fpLocal[".concat(e,"] is not a file")),o;let i=v.default.statSync(e),a=Yt(i,"size");if(!Fn(a))return o.reject("can not get the size of file[".concat(e,"]")),o;a=Tn(a);let u=v.default.readFileSync(e),c=0;return t.put(u,r,((t,i)=>{if(t)o.reject(t);else if(0!==$e(i)){if(Nn(n)){let t=$e(i);c+=t,n({progress:c/a*100,name:Kn(e),fpRemote:r,fpLocal:e})}}else o.resolve("ok")})),o}return{conn:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=On(),n=Yt(e,"hostname");if(!An(n))return r.reject("hostname[".concat(n,"] is not a effective string")),r;let o=Yt(e,"port");if(!In(o))return r.reject("port[".concat(o,"] is not a positive integer")),r;o=Tn(o);let i=Yt(e,"username");if(!An(i))return r.reject("username[".concat(i,"] is not a effective string")),r;let a=Yt(e,"password");if(!An(a))return r.reject("password[".concat(a,"] is not a effective string")),r;try{t=new yo({host:n,port:o,user:i,pass:a}),r.resolve("ok")}catch(t){r.reject(t)}return r},ls:e,stateFile:r,checkFile:async function(t){return qn(await r(t))},download:n,syncToLocal:async function(r,o,i){if(null===t)return Promise.reject("FTP has not been initialized. please use 'conn' to construct FTP");let a=await e(r);Yn(o)||to(o);let u=Xn(o);u=an(u,(t=>!t.isFolder)),u=Sn(u,(t=>{let e=v.default.statSync(t.path);return t.size=Rn(Yt(e,"size","")),t}));let c=0,s=[];return await Gn(a,(async t=>{let e=wn(u,{name:t.name}),a=r;"/"!==!Un(a,1)&&(a+="/"),a+=Yt(t,"name","");let f=h.default.resolve(o,Yt(t,"name","")),l=t=>{Nn(i)&&i(t)};qn(e)?t.size!==e.size&&(await n(a,f,l),c++,s.push({name:t.name,reason:"size[".concat(e.size,"] of local file != size[").concat(t.size,"] of remote file")})):(await n(a,f,l),c++,s.push({name:t.name,reason:"no local file"}))})),{num:c,files:s}},syncToRemote:async function(r,n,i){if(null===t)return Promise.reject("FTP has not been initialized. please use 'conn' to construct FTP");let a=await e(n);if(!Yn(r))return Promise.reject("fdLocal[".concat(r,"] is not a folder"));let u=Xn(r);u=an(u,(t=>!t.isFolder)),u=Sn(u,(t=>{let e=v.default.statSync(t.path);return t.size=Rn(Yt(e,"size","")),t}));let c=0,s=[];return await Gn(u,(async t=>{let e=wn(a,{name:t.name}),u=n;"/"!==!Un(u,1)&&(u+="/"),u+=Yt(t,"name","");let f=h.default.resolve(r,Yt(t,"name","")),l=t=>{Nn(i)&&i(t)};qn(e)?t.size!==e.size&&(await o(f,u,l),c++,s.push({name:t.name,reason:"size[".concat(e.size,"] of remote file != size[").concat(t.size,"] of local file")})):(await o(f,u,l),c++,s.push({name:t.name,reason:"no Remote file"}))})),{num:c,files:s}},upload:o,quit:async function(){let e=On();return null===t?(e.reject("FTP has not been initialized. please use 'conn' to construct FTP"),e):(t.raw("quit",((t,r)=>{t?e.reject(t):e.resolve(r)})),e)}}}}}));
//# sourceMappingURL=w-ftp.umd.js.map
